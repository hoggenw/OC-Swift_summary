#轮播新闻的实现

```
class PSHeadlinesView: UIView {
    
    var scrollView: UIScrollView?
    var currentPageIndex: Int?
    var animationTimer: Timer?
    
    //block
    var contentViewAtIndex : ((_ pageIndex: Int)->String)?
    var tapActionBlock: ((_ pageIndex: Int)-> Void)?
    //private
    private var firstLabel: UILabel = PSHeadlinesView.labelConfigure()
    private var secondLabel: UILabel = PSHeadlinesView.labelConfigure()
    private var firstLabelStatus: Bool = true
    private var totalPages:  Int?
    private var textArray: [String] = []
    
    public var animationInterval : TimeInterval?
    
    deinit {
        if self.animationTimer != nil {
            self.animationTimer?.invalidate();
            self.animationTimer = nil;
        }
        NotificationCenter.default.removeObserver(self)
        
    }
    
    init(frame: CGRect ,_ duration: TimeInterval) {
        super.init(frame: frame)
        
        animationInterval = duration
        self.clipsToBounds = true
        self.animationTimer = Timer.scheduledTimer(timeInterval: animationInterval!, target: self, selector: #selector(animationTimerDidFire(timer:)), userInfo: nil, repeats: true)
        RunLoop.current.add(self.animationTimer!, forMode: .commonModes)
        self.animationTimer?.pause()
        self.addSubview(firstLabel)
        self.addSubview(secondLabel)
        firstLabel.addGestureRecognizer(UITapGestureRecognizer(target: self, action: #selector(contentViewTapped(sender:))))
        secondLabel.addGestureRecognizer(UITapGestureRecognizer(target: self, action: #selector(contentViewTapped(sender:))))
        NotificationCenter.default.addObserver(self, selector: #selector(resignActive), name: NSNotification.Name.UIApplicationWillResignActive, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(becomeActive), name:NSNotification.Name.UIApplicationDidBecomeActive, object: nil)
    }
    
    func resignActive() {
        if animationTimer != nil, let total = self.totalPages, total > 1 {
            animationTimer?.pause()
            print("后台暂停")
        }
        
    }
    
    func becomeActive() {
        let tabController : UITabBarController =  UIApplication.shared.keyWindow?.rootViewController as! UITabBarController

        if animationTimer != nil && tabController.selectedIndex == 0, let total = self.totalPages, total > 1 {
            animationTimer?.resumeAfterInterval(3.0)
            print("后台活跃")
        }
    }
    
    //MARK:设置总页数后，启动动画
    
    func setTotalPagesCount(totalPageCout: (()->(Int))) {
        
        if self.totalPages != nil {
            return
        }
        self.totalPages = totalPageCout()
        print("totalPages = \(self.totalPages)")
        if let  index =  self.currentPageIndex{
            if index > self.totalPages! {
                self.currentPageIndex = 0
            }
        }else {
            self.currentPageIndex = 0
        }
        self.addSubview(firstLabel)
        self.addSubview(secondLabel)
        if self.totalPages == 1 {
            firstLabel.frame = CGRect(x: 0, y: 0, width: self.bounds.width, height: self.bounds.height)
            configureContentViews()
            return
        }
        
        if self.totalPages! > 0  {
            firstLabel.frame = CGRect(x: 0, y: 0, width: self.bounds.width, height: self.bounds.height)
            secondLabel.frame = CGRect(x: 0, y: self.bounds.height, width: self.bounds.width, height: self.bounds.height)
            configureContentViews()
            self.animationTimer?.resumeAfterInterval(self.animationInterval!)
        }
        
    }
    static func labelConfigure() -> UILabel{
        let label = UILabel()
        label.textAlignment = .left
        label.textColor =  UIColor(hex: 0x333333)
        label.font = UIFont.systemFont(ofSize: 16)
        label.isUserInteractionEnabled = true
        return label
    }
    
    func configureContentViews() {
        
        setScrollViewDataSource()
        
        switch firstLabelStatus {
        case true:
            firstLabel.text = textArray.first
            secondLabel.text = textArray.last
        default:
            firstLabel.text = textArray.last
            secondLabel.text = textArray.first
        }
        
        
    }
    
    //点击事件
    func contentViewTapped(sender: UIGestureRecognizer){
        if self.tapActionBlock != nil {
            self.tapActionBlock!(self.currentPageIndex!)
        }
        
    }
    //获取数据
    func setScrollViewDataSource () {
        let rearIndex = validateNextPageIndexWithPageIndex(index: (self.currentPageIndex! + 1))
        textArray.removeAll()
        if self.totalPages! > 0 {
            if self.contentViewAtIndex != nil {
                
                textArray.append(self.contentViewAtIndex!(currentPageIndex!))
                
                textArray.append(self.contentViewAtIndex!(rearIndex))
            }
        }
        
    }
    //获取下标
    func validateNextPageIndexWithPageIndex(index: Int) -> Int {
        
        if index < 0 {
            return self.totalPages! - 1;
        }else if index >= self.totalPages!{
            return 0
        }else {
            return index
        }
        
        
    }
    
    func animationTimerDidFire(timer:Timer){
        configureContentViews()
        self.currentPageIndex = validateNextPageIndexWithPageIndex(index: (self.currentPageIndex! + 1))
        var frame = firstLabel.frame
        var secondFrame = secondLabel.frame
        frame.origin.y = frame.origin.y - self.bounds.height
        secondFrame.origin.y = secondFrame.origin.y - self.bounds.height
        if firstLabelStatus {
            UIView.animate(withDuration: 0.3, animations: {
                self.firstLabel.frame = frame
            }, completion: { (finish) in
                if finish {
                    UIView.animate(withDuration: 0.5, animations: {
                        
                        self.secondLabel.frame = secondFrame
                    }, completion: { (done) in
                        self.firstLabel.frame = CGRect(x: 0, y: self.bounds.height, width: self.bounds.width, height: self.bounds.height)
                        
                    })
                }
            })
        }else {
            UIView.animate(withDuration: 0.3, animations: {
                self.secondLabel.frame = secondFrame
            }, completion: { (finish) in
                if finish {
                    UIView.animate(withDuration: 0.5, animations: {
                        self.firstLabel.frame = frame
                    }, completion: { (done) in
                        self.secondLabel.frame = CGRect(x: 0, y: self.bounds.height, width: self.bounds.width, height: self.bounds.height)
                        
                    })
                }
            })
            
            
        }
        firstLabelStatus = !firstLabelStatus
       

        
    }
    
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
}

```

#终端直接打包APP（测试）

```

xcrun -sdk iphoneos packageApplication -v  /Users/ios-mac/Library/Developer/Xcode/DerivedData/QianJiWang-dczvfxabkezjiyfuekibakmisdme/Build/Products/Debug-iphoneos/QianJiWang.app -o ~/Desktop/QianJiWang.ipa

```

